<script>
  const BASE = `${location.origin}`;
  const categories = [
    "404","Online Booking","About Us","Password","Announcement Bar","Payment",
    "Benefits : Statistics","Popup","Blog Articles","Pricing Plan","Blog Category",
    "Privacy Policy","CTA : Banner","Product Highlight Bar","Calendar","Product Page",
    "Case Studies","Product Specs","Comparison Chart","Profile","Contact Us",
    "Registration : Progress Steps","Courses","Reviews","Dashboard","Services","FAQ",
    "Sign In","Features","Sign Up","Footer","Simple Text","Form : Survey : Quiz",
    "Social Media","Forums : Discussion","Tables","Gallery","Team","Hero",
    "Testimonials","How It Works","Trusted Badges","Integrations","Upload : Download","Menu-Nav"
  ];

  const catSel = document.getElementById("category");
  const devSel = document.getElementById("device");
  const modeSel = document.getElementById("mode");
  const gallery = document.getElementById("gallery");
  const loading = document.getElementById("loading");

  categories.forEach(c => catSel.add(new Option(c, c)));

  function getFilePatterns(cat) {
    const safeCat = cat.replace(/ /g, '%20');
    const patterns = [
      `${safeCat}%20Blocks-`,          // normal case
      `${safeCat}%20Error%20Blocks-`,  // 404 or others with "Error"
      `${safeCat}-`                    // fallback
    ];
    return patterns;
  }

  async function checkImageExists(url) {
    const res = await fetch(url, { method: 'HEAD' });
    return res.ok;
  }

  async function loadImages() {
    const cat = catSel.value;
    const dev = devSel.value;
    const mode = modeSel.value;
    const patterns = getFilePatterns(cat);

    gallery.innerHTML = "";
    loading.style.display = "flex";

    const fragment = document.createDocumentFragment();

    for (let i = 1; i <= 120; i++) {
      let imgUrl = null;

      for (const pattern of patterns) {
        const candidate = `${BASE}/${cat}/${dev}/${mode}/${pattern}${i}_result.webp`;
        if (await checkImageExists(candidate)) {
          imgUrl = candidate;
          break;
        }
      }

      if (imgUrl) {
        const img = new Image();
        img.src = imgUrl;
        img.loading = "lazy";
        img.decoding = "async";
        img.alt = `${cat} block ${i}`;
        img.className = "block-card w-full rounded-xl shadow hover:scale-[1.02]";
        fragment.appendChild(img);
      }
    }

    gallery.appendChild(fragment);
    loading.style.display = "none";
  }

  catSel.onchange = loadImages;
  devSel.onchange = loadImages;
  modeSel.onchange = loadImages;

  catSel.value = "404";
  loadImages();
</script>
